<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="This package provides functions to obtain surrogate splits
    applying ranger for random forests generation and using modified
    functions from the package rpart. Surrogate variables and
    corresponding adjusted agreement values are used for surrogate minimal
    depth variable importance and to investigate variable relations.">
<title>Surrogate Minimal Depth Variable Importance • RFSurrogates</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Surrogate Minimal Depth Variable Importance">
<meta property="og:description" content="This package provides functions to obtain surrogate splits
    applying ranger for random forests generation and using modified
    functions from the package rpart. Surrogate variables and
    corresponding adjusted agreement values are used for surrogate minimal
    depth variable importance and to investigate variable relations.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">RFSurrogates</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="rfsurrogates">RFSurrogates<a class="anchor" aria-label="anchor" href="#rfsurrogates"></a>
</h1></div>
<p>In this R package, several functions are provided for applying approaches based on random forest. Minimal depth (MD), Surrogate minimal depth (SMD) and mutual impurity reduction (MIR), which is a corrected approach of SMD, can be applied to assess the importance of variables and to select important variables. In addition, the parameters mean adjusted agreement and mutual forest impact (MFI), a corrected approach of the previous, can be applied to investigate variable relations based on surrogate variables.</p>
<p>Please cite the following manuscripts if you use the package:</p>
<p>[1] S. Seifert, S. Gundlach, S. Szymczak, Surrogate minimal depth as an importance measure for variables in random forests, Bioinformatics 2019, 35, 3663-3671.</p>
<p>[2] publication about MFI/MIR under preparation</p>
</div>
<div class="section level1">
<h1 id="install">Install<a class="anchor" aria-label="anchor" href="#install"></a>
</h1>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="fu">install_github</span><span class="op">(</span><span class="st">"AGSeifert/RFSurrogates"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level1">
<h1 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h1>
<p>The package contains an example data set which consists of a single replicate of the simulation study 1 in publication [1]. Please refer to the paper and the documentation of the SMD_example_data for further details on the simulation scenario. The R script for the simulation is published here: doi.org/10.25592/uhhfdm.12620.</p>
</div>
<div class="section level1">
<h1 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h1>
<p>First the package and the example data are loaded:</p>
<pre><code>library(RFSurrogates
data("SMD_example_data")
dim(SMD_example_data)
[1] 100 201

head(SMD_example_data[, 1:5])
           y          X1         X2         X3           X4
1  1.8222421 -0.02768266 -1.1019154  2.2659401  0.008021516
2 -1.0401813  0.73258486 -0.4107975  0.7587792 -0.718752746
3  2.7139607 -0.05399936  1.1851261  0.9743160 -2.563176970
4 -0.7081372 -0.84838121 -0.8975802  0.5247899  1.180683275
5 -1.0264429 -0.42219003  0.5439467 -0.1626504  0.682333020
6  3.1871209  0.91722598  0.1974106  0.9571554  0.351634641
</code></pre>
<p>The data set has 100 observations in the rows and the columns contain the continuous outcome variable y and 200 continuous predictor variables in the columns.</p>
<div class="section level2">
<h2 id="minimal-depth">Minimal depth<a class="anchor" aria-label="anchor" href="#minimal-depth"></a>
</h2>
<p>First, we perform variable selection based on minimal depth using 1000 trees in the random forest. To make the analysis reproducible we set the seed first.</p>
<pre><code>set.seed(42)
res.md = var.select.md(x = SMD_example_data[,2:ncol(SMD_example_data)], y = SMD_example_data[,1], ntree=1000)
res.md$var
[1] "X2"     "X3"     "X4"     "X5"     "X6"     "cp1_8"  "cp2_6"  "cp2_7"  "cp3_4"  "cp3_6"  "cp8_10" "cgn_68" "cgn_72" "cgn_81"</code></pre>
<p>The selected variables are stored in res.md$var. In this analysis the relevant basic variables X2 to X6, as well as the relevant variables cp2_6, cp2_7, cp3_4, and cp3_6, and the non-relevant variables cp8_10, cgn_68, cgn_72, and cgn_81 are selected.</p>
<p>The MD values for each predictor variable and the threshold to select variables can be extracted as follows:</p>
<pre><code>md = res.md$info$depth
head(md)
   X1    X2    X3    X4    X5    X6 
9.823 7.848 6.164 6.662 6.442 6.390 

res.md$info$threshold
[1] 9.23097</code></pre>
<p>We can see that variables X2, …, X6 have MD values smaller than the threshold in contrast to X1.</p>
</div>
<div class="section level2">
<h2 id="surrogate-minimal-depth-smd">Surrogate Minimal depth (SMD)<a class="anchor" aria-label="anchor" href="#surrogate-minimal-depth-smd"></a>
</h2>
<p>Now we would like to analyze the example data with surrogate minimal depth which works similarly. However, we need to specify an additional parameter s, i.e. the number of surrogate variables that should be considered. In this analysis we use s = 10. Based on our simulation studies we recommend to set this parameter to approximately 1% of the predictor variables in larger datasets.</p>
<p>Variable selection with var.select.smd is conducted:</p>
<pre><code>set.seed(42)
res.smd = var.select.smd(x = SMD_example_data[,2:ncol(SMD_example_data)], y = SMD_example_data[,1], s = 10, ntree = 1000)
res.smd$var
 [1] "X1"     "X2"     "X3"     "X4"     "X5"     "X6"     "cp1_1"  "cp1_2"  "cp1_3"  "cp1_4"  "cp1_5"  "cp1_6"  "cp1_7"  "cp1_8"  "cp1_9" 
[16] "cp1_10" "cp2_4"  "cp2_6" </code></pre>
<p>The selected variables are stored in res.smd$var. In this analysis the relevant basic variables X1 to X6, as well as the relevant variables cp1_1 to cp1_10, cp2_4, and cp2_6 are selected. Compared to MD more of the relevant variables and none of the non-relevant variables are selected.</p>
<p>The SMD values for each predictor variable and the threshold to select variables can be extracted as follows:</p>
<pre><code>smd = res.smd$info$depth
head(smd)
  X1    X2    X3    X4    X5    X6 
2.344 2.287 2.095 2.576 2.509 2.276 

res.smd$info$threshold
[1] 2.690082</code></pre>
<p>We can see that variables X1, …, X6 have SMD values smaller than the threshold.</p>
</div>
<div class="section level2">
<h2 id="variable-relations-based-on-the-mean-adjusted-agreement-of-surrogate-variables">Variable relations based on the mean adjusted agreement of surrogate variables<a class="anchor" aria-label="anchor" href="#variable-relations-based-on-the-mean-adjusted-agreement-of-surrogate-variables"></a>
</h2>
<p>Now we want to investigate the relations of variables. We would like to identify which of the first 100 predictor variables are related to X1 and X7. We simulated 10 correlated predictor variables for each of these two basic variables. One possibility to investigate variable relations is to use the results from var.select.smd. Hence, first SMD is conducted like in the previous section:</p>
<pre><code><span><span class="va">res.smd</span> <span class="op">=</span> <span class="fu"><a href="reference/var.select.smd.html">var.select.smd</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">SMD_example_data</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">SMD_example_data</span><span class="op">)</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">SMD_example_data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, s <span class="op">=</span> <span class="fl">10</span>, ntree <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre>
<p>Subsequently, variable relations are analyzed with var.relations. The parameter t can be adapted to either focus on strongly related variables only (high numbers) or to include also moderately related variables (low numbers):</p>
<pre><code>candidates = colnames(SMD_example_data )[2:101]
rel = var.relations(forest = res.smd$forest, variables = c("X1","X7"), candidates = candidates, t = 5)
rel$var
$X1
 [1] "cp1_1"  "cp1_2"  "cp1_3"  "cp1_4"  "cp1_5"  "cp1_6"  "cp1_7"  "cp1_8"  "cp1_9"  "cp1_10"

$X7
 [1] "cp7_1"  "cp7_2"  "cp7_3"  "cp7_4"  "cp7_5"  "cp7_6"  "cp7_7"  "cp7_8"  "cp7_9"  "cp7_10"
  </code></pre>
<p>All of the variables that are correlated to X1 are correctly identified as related to X1 and all of the variables that are correlated to X7 are correcly identified as related to X7.</p>
</div>
<div class="section level2">
<h2 id="variable-relations-based-on-mutual-forest-impact-mfi">Variable relations based on mutual forest impact (MFI)<a class="anchor" aria-label="anchor" href="#variable-relations-based-on-mutual-forest-impact-mfi"></a>
</h2>
<p>MFI is a corrected relation parameter calculated by the mean adjusted agreement of the variables and permuted versions of them. Related variables are selected by p-values obtained from a null distribution either determined by negative relation scores (based on the Janitza approach) or by permuted relations. We use the default parameters for the selection here, which is a p-values threshold of 0.01 and the Janitza approach.</p>
<pre><code>set.seed(42)
rel.mfi = var.relations.mfi(x = x, y = y, s = 10, ntree = 1000, variables = c("X1","X7"), candidates = colnames(x)[1:100], p.t = 0.01, method = "janitza" )
rel.mfi$var.rel
$X1
 [1] "cp1_1"  "cp1_2"  "cp1_3"  "cp1_4"  "cp1_5"  "cp1_6"  "cp1_7"  "cp1_8"  "cp1_9"  "cp1_10"

$X7
 [1] "cp7_1"  "cp7_2"  "cp7_3"  "cp7_4"  "cp7_5"  "cp7_6"  "cp7_7"  "cp7_8"  "cp7_9"  "cp7_10"</code></pre>
<p>Also by MFI, all of the variables that are correlated to X1 are correctly identified as related to X1 and all of the variables that are correlated to X7 are correcly identified as related to X7. Also the matrix of determined relation (surr.res), permuted relations (surr.perm) and determined p-values (p.rel) can be extracted as followes:</p>
<pre><code><span><span class="va">MFI</span> <span class="op">=</span> <span class="va">rel.mfi</span><span class="op">$</span><span class="va">surr.res</span></span>
<span><span class="va">surr.perm</span> <span class="op">=</span> <span class="va">rel.mfi</span><span class="op">$</span><span class="va">surr.perm</span></span>
<span><span class="va">p.rel</span> <span class="op">=</span> <span class="va">rel.mfi</span><span class="op">$</span><span class="va">p.rel</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="mutual-impurity-reduction-mir">Mutual impurity reduction (MIR)<a class="anchor" aria-label="anchor" href="#mutual-impurity-reduction-mir"></a>
</h2>
<p>Now we would like to analyze the example data with MIR, which determines the variable importance by the actual impurity reduction combined with the relations determined by MFI. Different to MD and SMD, this approach calculates p-values for the selection of important variables. For this, the null distribution is obtained in a similar way as for MFI, either by negative importance scores called the Janitza approach or by permutation. Since this example dataset is comparatively small, we use the permutation approach. As a threshold for selection a value of 0.01 is applied (p.t.sel = 0.01).</p>
<pre><code>set.seed(42)
res.mir = var.select.mir(x = SMD_example_data[,2:ncol(SMD_example_data)], y = SMD_example_data[,1], s = 10, ntree = 1000, method.sel = "permutation", p.t.sel = 0.01)
res.mir$var
 [1] "X1"     "X2"     "X3"     "X4"     "X5"     "X6"     "cp1_1"  "cp1_2"  "cp1_3"  "cp1_4"  "cp1_5"  "cp1_6" 
[13] "cp1_7"  "cp1_8"  "cp1_9"  "cp1_10" "cp2_1"  "cp2_3"  "cp2_4"  "cp2_6"  "cp2_7"  "cp2_10" "cp3_1"  "cp3_4" 
[25] "cp3_5"  "cgn_72" "cgn_81"</code></pre>
<p>The selected variables are stored in res.mir$var. Here, the relevant variables cp1_1 to cp1_10, cp2_1, cp2_3, cp2_4, cp2_6, cp2_7, cp2_10, cp3_1, cp3_4, cp3_5, as well as the non-relevant variables cgn_72 and cgn_81 are selected.</p>
<p>The MIR values and p-values can be extracted as follows:</p>
<pre><code>mir = res.mir$info$MIR
head(mir)
      X1       X2       X3       X4       X5       X6 
10.68243 15.95674 27.09036 20.50233 23.16293 21.15731 

pvalues = res.mir$info$pvalue
head(pvalues)
X1 X2 X3 X4 X5 X6 
 0  0  0  0  0  0 
 </code></pre>
<p>We can see that variables X1, …, X6 have a p-value of 0 and are selected.</p>
<p>Since this approach is based on the actual impurity reduction combined with the relations determined by MFI, both of these can also be extracted from the results:</p>
<pre><code>air = res.mir$info$AIR
head(air)
       X1        X2        X3        X4        X5        X6 
 1.072849 13.133904 26.444900 19.155187 22.718355 20.782305 
 
 res.mfi = res.mir$info$relations
</code></pre>
<p>res.mfi contains the results of var.relations.mfi conducted in MIR.</p>
</div>
</div>

  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing RFSurrogates</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Stephan Seifert <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-2567-5728" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Sven Gundlach <br><small class="roles"> Author </small>  </li>
<li>Silke Szymczak <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Stephan Seifert, Sven Gundlach, Silke Szymczak.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
